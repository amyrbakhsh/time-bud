{% extends 'base.html' %}

{% block content %}
<h2>My Dashboard</h2>

<section>
    <h3>My Watches</h3>
    {% if watches %}
        <ul>
            {% for watch in watches %}
                <li>
                    <a href="{% url 'watch_detail' watch.id %}">
                        {{ watch.brand }} - {{ watch.title }}
                    </a>
                    {% if watch.id in sold_watch_ids %}
                        <span style="color: red; font-weight: bold;">SOLD</span>
                    {% elif not watch.is_available %}
                        <form action="{% url 'start_auction' watch.id %}" method="POST" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="btn submit">List for Auction</button>
                        </form>
                    {% else %}
                        <span style="color: green; font-weight: bold;">Auction Live</span>
                    {% endif %}
        
                    {% if watch.image %}
                        <div>
                            <img src="{{ watch.image.url }}" alt="Watch Image" width="200">
                        </div>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>You haven't listed any watches yet</p>
    {% endif %}
</section>

<section>
    <h3>My Bids</h3>
    {% if bids %}
        <ul>
            {% for bid in bids %}
                <li>
                    Bid on <a href="{% url 'watch_detail' bid.watch.id %}">
                        {{ bid.watch.brand }} - {{ bid.watch.title }}
                    </a> for ${{ bid.amount }}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>You haven't placed any bids yet</p>
    {% endif %}
</section>
<section>
    <h3>Bids on My Watches</h3>
    {% if bids_on_user_watches %}
        <ul>
            {% for bid in bids_on_user_watches %}
                <li>
                    <strong>${{ bid.amount }}</strong> from {{ bid.bidder.username }} on 
                    <a href="{% url 'watch_detail' bid.watch.id %}">{{ bid.watch.title }}</a>
                    â€”
                    <a href="{% url 'accept_bid' bid.id %}">Accept</a>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No bids yet on your watches.</p>
    {% endif %}
</section>

<section>
    <h3>My Transactions</h3>
    {% if transactions %}
        <ul>
            {% for transaction in transactions %}
            <li>
                {% if transaction.buyer == user %}
                  You bought a {{ transaction.watch.brand }} - {{ transaction.watch.title }} from {{ transaction.seller.username }}.
                {% elif transaction.seller == user %}
                  You sold a {{ transaction.watch.brand }} - {{ transaction.watch.title }} to {{ transaction.buyer.username }}.
                {% endif %}
              </li>
              
            {% endfor %}
        </ul>
    {% else %}
        <p>No transactions yet</p>
    {% endif %}
</section>
{% endblock %}
